from sqlalchemy import Integer, String, select
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy.orm import Mapped, mapped_column

from db.db import AsyncSessionLocal, Base
from db.models.base import TimestampMixin

BASE_PRICES = {
    # "subscription_start": 2490,
    # "subscription_start_3": 6990,
    # "subscription_long": 2490,
    "ai_prediction": 300,
    "one_question": 1000,
    "financial_analysis": 1000,
    "natal_chart_analysis": 1000,
    "solar_analysis": 10000,
}

BASE_PRICES_RU = {
    # "subscription_start": "¬´–ü–µ—Ä–≤–∏—á–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞¬ª",
    # "subscription_start_3": "¬´–ü–µ—Ä–≤–∏—á–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ 3 –º–µ—Å—è—Ü–∞¬ª",
    # "subscription_long": "¬´–ü—Ä–æ–¥–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏¬ª",
    "unknown": "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —É—Å–ª—É–≥–∞",
    "ai_prediction": "–êI-–ø—Ä–æ–≥–Ω–æ–∑",
    "one_question": "–û–¥–∏–Ω –≤–æ–ø—Ä–æ—Å",
    "financial_analysis": "–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ä–∞–∑–±–æ—Ä",
    "natal_chart_analysis": "–†–∞–∑–±–æ—Ä –ù–∞—Ç–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç—ã",
    "solar_analysis": "–°–æ–ª—è—Ä",
}

BASE_PRICES_RU_SHORT = {
    # "subscription_start": "–ü–µ—Ä–≤–∏—á–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞",
    # "subscription_start_3": "–ü–µ—Ä–≤–∏—á–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ 3 –º–µ—Å—è—Ü–∞",
    # "subscription_long": "–ü—Ä–æ–¥–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏",
    "unknown": "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —É—Å–ª—É–≥–∞",
    "ai_prediction": "–êI-–ø—Ä–æ–≥–Ω–æ–∑",
    "one_question": "–û–¥–∏–Ω –≤–æ–ø—Ä–æ—Å",
    "financial_analysis": "–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ä–∞–∑–±–æ—Ä",
    "natal_chart_analysis": "–†–∞–∑–±–æ—Ä –ù–∞—Ç–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç—ã",
    "solar_analysis": "–°–æ–ª—è—Ä",
}

EXTRA_DESCRIPTIONS = {
    "one_question": """
<b><i>–£—Å–ª—É–≥–∞ ¬´–û–¥–∏–Ω –≤–æ–ø—Ä–æ—Å¬ª ü™ê</i></b>

<i>–ß—Ç–æ –≤—Ö–æ–¥–∏—Ç:

<b><i>‚Ä¢</i></b> —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –ª—é–±–æ–π —Å—Ñ–µ—Ä—ã –∂–∏–∑–Ω–∏,
<b><i>‚Ä¢</i></b> —Ä–∞–∑–±–æ—Ä –≤–∞—à–µ–π —Å–∏—Ç—É–∞—Ü–∏–∏,
<b><i>‚Ä¢</i></b> –ø–æ–¥—Å–∫–∞–∑–∫–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏,
<b><i>‚Ä¢</i></b> –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ —Å–æ–±—ã—Ç–∏–π.

</i><i><b>–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</b> ‚Äî –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤ —Å –º–æ–º–µ–Ω—Ç–∞ –æ–ø–ª–∞—Ç—ã.

–í–∞–∂–Ω—ã–µ —É—Å–ª–æ–≤–∏—è:</i>

<i><b><i>‚Ä¢</i></b> –≤ —Å–ª—É—á–∞–µ —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏ –≤ –≤—ã—Ö–æ–¥–Ω–æ–π –¥–µ–Ω—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥–∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ 50%,
<b><i>‚Ä¢</i></b> –ª—é–±—É—é —É—Å–ª—É–≥—É –º–æ–∂–Ω–æ –æ—Ñ–æ—Ä–º–∏—Ç—å –≤ —Ä–∞—Å—Å—Ä–æ—á–∫—É –¥–æ 6 –º–µ—Å—è—Ü–µ–≤ –±–µ–∑ –ø–µ—Ä–µ–ø–ª–∞—Ç.</i>

<i>–î–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π ‚Äî –ø–∏—à–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è</i> üåô

<i>‚ñ≥ –°—Ç–æ–∏–º–æ—Å—Ç—å ‚Äî {price} —Ä—É–±–ª–µ–π. </i>""",
    "financial_analysis": """
<b><i>–£—Å–ª—É–≥–∞ ¬´–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ä–∞–∑–±–æ—Ä¬ª ü™ê</i></b>

<i>–ß—Ç–æ –≤—Ö–æ–¥–∏—Ç:

<b><i>‚Ä¢</i></b> —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π –≤ –ù–∞—Ç–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç–µ,
<b><i>‚Ä¢</i></b> –æ—Ç–≤–µ—Ç –Ω–∞ –≥–ª–∞–≤–Ω—ã–π –≤–æ–ø—Ä–æ—Å:
¬´–ß–µ–º –º–Ω–µ –∑–∞–Ω–∏–º–∞—Ç—å—Å—è/–≥–¥–µ —Ä–∞–±–æ—Ç–∞—Ç—å, —á—Ç–æ–±—ã –±—ã–ª–∏ –¥–µ–Ω—å–≥–∏?¬ª,
<b><i>‚Ä¢</i></b> –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.

</i><i><b>–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</b> ‚Äî –≤ —Ç–µ—á–µ–Ω–∏–µ 3 –¥–Ω–µ–π —Å –º–æ–º–µ–Ω—Ç–∞ –æ–ø–ª–∞—Ç—ã.

–í–∞–∂–Ω—ã–µ —É—Å–ª–æ–≤–∏—è:</i>

<i><b><i>‚Ä¢</i></b> –≤ —Å–ª—É—á–∞–µ —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏ –≤ –≤—ã—Ö–æ–¥–Ω–æ–π –¥–µ–Ω—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥–∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ 50%,
<b><i>‚Ä¢</i></b> –ª—é–±—É—é —É—Å–ª—É–≥—É –º–æ–∂–Ω–æ –æ—Ñ–æ—Ä–º–∏—Ç—å –≤ —Ä–∞—Å—Å—Ä–æ—á–∫—É –¥–æ 6 –º–µ—Å—è—Ü–µ–≤ –±–µ–∑ –ø–µ—Ä–µ–ø–ª–∞—Ç.</i>

<i>–î–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π ‚Äî –ø–∏—à–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è</i> üåô

<i>‚ñ≥ –°—Ç–æ–∏–º–æ—Å—Ç—å ‚Äî {price} —Ä—É–±–ª–µ–π. </i>""",
    "natal_chart_analysis": """
<b><i>–£—Å–ª—É–≥–∞ ¬´–†–∞–∑–±–æ—Ä –ù–∞—Ç–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç—ã¬ª ü™ê</i></b>

<i>–ß—Ç–æ –≤—Ö–æ–¥–∏—Ç:

<b><i>‚Ä¢</i></b> –ø–æ–¥—Ä–æ–±–Ω—ã–π —Ä–∞–∑–±–æ—Ä 12 —Å—Ñ–µ—Ä –∂–∏–∑–Ω–∏,
<b><i>‚Ä¢</i></b> —É–≥–ª—É–±–ª—ë–Ω–Ω–æ–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –≤–æ–ª–Ω—É—é—â–∏—Ö –∏–º–µ–Ω–Ω–æ –≤–∞—Å —Å—Ñ–µ—Ä,
<b><i>‚Ä¢</i></b> –∫–æ–º–ø–µ–Ω—Å–∞—Ç–æ—Ä–∏–∫–∞ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π,
<b><i>‚Ä¢</i></b> –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.

</i><i><b>–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</b> ‚Äî –≤ —Ç–µ—á–µ–Ω–∏–µ 5</i>-<i>7 –¥–Ω–µ–π —Å –º–æ–º–µ–Ω—Ç–∞ –æ–ø–ª–∞—Ç—ã.

–í–∞–∂–Ω—ã–µ —É—Å–ª–æ–≤–∏—è:</i>

<i><b><i>‚Ä¢</i></b> –≤ —Å–ª—É—á–∞–µ —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏ –≤ –≤—ã—Ö–æ–¥–Ω–æ–π –¥–µ–Ω—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥–∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ 50%,
<b><i>‚Ä¢</i></b> –ª—é–±—É—é —É—Å–ª—É–≥—É –º–æ–∂–Ω–æ –æ—Ñ–æ—Ä–º–∏—Ç—å –≤ —Ä–∞—Å—Å—Ä–æ—á–∫—É –¥–æ 6 –º–µ—Å—è—Ü–µ–≤ –±–µ–∑ –ø–µ—Ä–µ–ø–ª–∞—Ç.</i>

<i>–î–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π ‚Äî –ø–∏—à–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è</i> üåô

<i>‚ñ≥ –°—Ç–æ–∏–º–æ—Å—Ç—å ‚Äî {price} —Ä—É–±–ª–µ–π. </i>""",
    "solar_analysis": """
<b><i>–£—Å–ª—É–≥–∞ ¬´–°–æ–ª—è—Ä¬ª (–ª–∏—á–Ω—ã–π –≥–æ–¥–æ–≤–æ–π –ø—Ä–æ–≥–Ω–æ–∑) ü™ê</i></b>

<i>–ß—Ç–æ –≤—Ö–æ–¥–∏—Ç:

<b><i>‚Ä¢</i></b> –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –ª–∏—á–Ω–æ–≥–æ –≥–æ–¥–∞,
<b><i>‚Ä¢</i></b> —É–∫–∞–∑–∞–Ω–∏–µ –Ω–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–µ—Ä–∏–æ–¥—ã,
<b><i>‚Ä¢</i></b> —É–∫–∞–∑–∞–Ω–∏–µ –Ω–∞ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ä–∏—Å–∫–∏ –∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏,
<b><i>‚Ä¢</i></b> –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.

</i><i><b>–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</b> ‚Äî –≤ —Ç–µ—á–µ–Ω–∏–µ 10-14 –¥–Ω–µ–π —Å –º–æ–º–µ–Ω—Ç–∞ –æ–ø–ª–∞—Ç—ã.

–í–∞–∂–Ω—ã–µ —É—Å–ª–æ–≤–∏—è:</i>

<i><b><i>‚Ä¢</i></b> –≤ —Å–ª—É—á–∞–µ —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏ –≤ –≤—ã—Ö–æ–¥–Ω–æ–π –¥–µ–Ω—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥–∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ 50%,
<b><i>‚Ä¢</i></b> –ª—é–±—É—é —É—Å–ª—É–≥—É –º–æ–∂–Ω–æ –æ—Ñ–æ—Ä–º–∏—Ç—å –≤ —Ä–∞—Å—Å—Ä–æ—á–∫—É –¥–æ 6 –º–µ—Å—è—Ü–µ–≤ –±–µ–∑ –ø–µ—Ä–µ–ø–ª–∞—Ç.</i>

<i>–î–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π ‚Äî –ø–∏—à–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è</i> üåô

<i>‚ñ≥ –°—Ç–æ–∏–º–æ—Å—Ç—å ‚Äî {price} —Ä—É–±–ª–µ–π. </i>""",
}


class Price(Base, TimestampMixin):
    __tablename__ = "prices"

    id: Mapped[int] = mapped_column(primary_key=True)
    name: Mapped[str] = mapped_column(String(100))
    amount: Mapped[int] = mapped_column(Integer)


async def get_price(
    service_name: str, session: AsyncSession | None = None
) -> int:
    if session is None:
        async with AsyncSessionLocal() as session:
            query = select(Price).where(Price.name == service_name)
            result = await session.execute(query)
            price = result.scalar_one_or_none()

            if price is None:
                return BASE_PRICES[service_name]

            return price.amount
    else:
        query = select(Price).where(Price.name == service_name)
        result = await session.execute(query)
        price = result.scalar_one_or_none()

        if price is None:
            return BASE_PRICES[service_name]
        return price.amount


async def set_price(service_name: str, amount: int) -> None:
    async with AsyncSessionLocal() as session:
        query = select(Price).where(Price.name == service_name)
        result = await session.execute(query)
        price = result.scalar_one_or_none()

        if price is None:
            price = Price(name=service_name, amount=amount)
            session.add(price)
        else:
            price.amount = amount

        await session.commit()
